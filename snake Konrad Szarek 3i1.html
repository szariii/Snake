<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .pole {
            border: solid black 1px;
            width: 20px;
            height: 20px;
            float: left;
        }

        .koniec {
            clear: both;
        }

        .sciana {
            background-color: black;
        }

        .jabko {
            background-image: url(./img/jablko.png);
        }

        .cialo {
            
        }

        .head {
            background-color: white;
        }

        .head-p {
            background-image: url(./img/glowa-p.png);
        }

        .head-g {
            background-image: url(./img/glowa-g.png);
        }

        .head-d {
            background-image: url(./img/glowa-d.png);
        }

        .head-l {
            background-image: url(./img/glowa-l.png);
        }

        .ogonek {
            background-color: white;
        }

        .ogonek-l {
            background-image: url(./img/ogon-l.png);
        }

        .ogonek-p {
            background-image: url(./img/ogon-p.png);
        }

        .ogonek-d {
            background-image: url(./img/ogon-d.png);
        }

        .ogonek-g {
            background-image: url(./img/ogon-g.png);
        }



        .body-d-g {
            background-image: url(./img/body-d-g.png);
        }

        .body-l-p {
            background-image: url(./img/body-l-p.png);
        }

        .body-g-d {
            background-image: url(./img/body-g-d.png);
        }

        .body-p-l {
            background-image: url(./img/body-p-l.png);
        }

        .skret-d-l {
            background-image: url(./img/skret-d-l.png);
        }

        .skret-d-p {
            background-image: url(./img/skret-d-p.png);
        }

        .skret-g-l {
            background-image: url(./img/skret-g-l.png);
        }

        .skret-g-p {
            background-image: url(./img/skret-g-p.png);
        }
    </style>
</head>

<body id="body" onkeydown="flagaruchu(event)">
    <div id="cmp"></div>

    <script>
        strona = "p"
        flaga = 5
        mozliwoscruchu = 1
        dlugosc = 1
        tab = generateArr()
        generateDOM(tab)

        poruszanieczas = setInterval(function () {
            ruch(flaga)
        }, 100)



        function generateArr() {
            var arr = []
            let jx = randomowa()
            let jy = randomowa()
            for (var i = 0; i < 12; i++) {
                arr[i] = []
                for (var j = 0; j < 12; j++) {
                    if (i == 0 || j == 0 || i == 11 || j == 11) {
                        arr[i][j] = "x"
                    } else if (i == 5 && j == 5) {
                        arr[i][j] = dlugosc
                    } else if (i == jx && j == jy) {
                        arr[i][j] = "j"
                    } else {
                        arr[i][j] = 0
                    }
                }
            }
            //console.table(arr)
            return arr
        }

        function randomowa() {
            let losowa = Math.floor(Math.random() * (10) + 1)
            //console.log(losowa)
            while (losowa == 5) {
                losowa = Math.floor(Math.random() * (10) + 1)
            }
            return losowa
        }


        function generateDOM(arr) {
            var cmp = document.getElementById("cmp")
            if (dlugosc > 1) {
                for (let ogoy = 1; ogoy < 11; ogoy++) {
                    ogox = arr[ogoy].findIndex(szukajkaogona)
                    if (ogox != -1) {
                        indexogon = { y: ogoy, x: ogox }
                    }
                }

                for (let nexty = 1; nexty < 11; nexty++) {
                    nextx = tab[nexty].findIndex(szukajkanexta)
                    if (nextx != -1) {
                        indexnext = { y: nexty, x: nextx }
                    }
                }

                if (indexogon.y - indexnext.y == 1) {
                    ogonek = "g"
                } else if (indexogon.y - indexnext.y == -1) {
                    ogonek = "d"
                } else if (indexogon.x - indexnext.x == -1) {
                    ogonek = "p"
                } else if (indexogon.x - indexnext.x == 1) {
                    ogonek = "l"
                }

            }
            for (var i = 0; i < arr.length; i++) {
                for (var j = 0; j < arr.length; j++) {



                    let div = document.createElement("div")
                    div.classList.add("pole")
                    div.id = i + "_" + j

                    if (dlugosc > 2) {
                        if (arr[i][j] != 0 && arr[i][j] != 1 && arr[i][j] != dlugosc && arr[i][j] != "x" && arr[i][j] != "j") {
                            let wartoscbody = arr[i][j]
                            //console.log(wartoscbody)
                            let wartoscznajdzm = wartoscbody - 1
                            let wartoscznajdzw = wartoscbody + 1



                            for (let ytabki = 1; ytabki < 11; ytabki++) {
                                let xtabki = tab[ytabki].indexOf(wartoscznajdzw)
                                if (tab[ytabki][xtabki] == wartoscznajdzw) {
                                    //console.log("ruch1")
                                    let nextwartoscx = xtabki
                                    let nextwartoscy = ytabki
                                    //console.log(nextwartoscx)
                                    //console.log(nextwartoscy)

                                    for (let yntabki = 1; yntabki < 11; yntabki++) {
                                        let xntabki = tab[yntabki].indexOf(wartoscznajdzm)
                                        if (tab[yntabki][xntabki] == wartoscznajdzm) {
                                            //console.log("ruch2 wartosc")
                                            let wczesniejszawartoscx = xntabki
                                            let wczesniejszawartoscy = yntabki
                                            //console.log(wczesniejszawartoscx)
                                            //console.log(wczesniejszawartoscy)


                                            let roznicaanx = j - nextwartoscx
                                            let roznicaany = i - nextwartoscy

                                            let roznicaawx = j - wczesniejszawartoscx
                                            let roznicaawy = i - wczesniejszawartoscy

                                            //console.log("roznicaanx" + roznicaanx)
                                            //console.log("roznicaany" + roznicaany)

                                            //console.log("roznicaawx" + roznicaawx)
                                            //console.log("roznicaawy" + roznicaawy)
                                            //console.log("----------------")

                                            if (roznicaanx == -1 && roznicaawy == 1) {
                                                //console.log("1")
                                                div.classList.add("skret-g-p")
                                            } else if (roznicaanx == 1 && roznicaawx == -1) {
                                                //console.log("2")
                                                div.classList.add("body-l-p")
                                            } else if (roznicaanx == -1 && roznicaawx == 1) {
                                                //console.log("3")
                                                div.classList.add("body-l-p")
                                            } else if (roznicaanx == -1 && roznicaawy == -1) {
                                                //console.log("4")
                                                div.classList.add("skret-d-p")
                                            } else if (roznicaanx == 1 && roznicaawy == 1) {
                                                //console.log("5")
                                                div.classList.add("skret-g-l")
                                            } else if (roznicaany == 1 && roznicaawy == -1) {
                                                //console.log("6")
                                                div.classList.add("body-d-g")
                                            } else if (roznicaany == -1 && roznicaawy == 1) {
                                                //console.log("7")
                                                div.classList.add("body-g-d")
                                            } else if ((roznicaanx == 1 && roznicaawy == -1)) {
                                                //console.log("8")
                                                div.classList.add("skret-d-l")
                                            } else if (roznicaany == 1 && roznicaawx == -1) {
                                                //console.log("9")
                                                div.classList.add("skret-g-p")
                                            } else if (roznicaany == 1 && roznicaawx == 1) {
                                                //console.log("10")
                                                div.classList.add("skret-g-l")
                                            } else if (roznicaany == -1 && roznicaawx == -1) {
                                                //console.log("11")
                                                div.classList.add("skret-d-p")
                                            } else if (roznicaany == -1 && roznicaawx == 1) {
                                                //console.log("12")
                                                div.classList.add("skret-d-l")
                                            }

                                        }
                                    }


                                }
                            }



                            /*console.log("nx " + nextwartoscx)
                            console.log("ny " + nextwartoscy)
                            console.log("px " + wczesniejszawartoscx)
                            console.log("py " + wczesniejszawartoscy)
                            */

                        }
                    }

                    function next(elemencik, wartoscbody) {
                        console.log(wartoscbody)
                        console.log(elemencik)
                        return elemencik == wartoscbody
                    }

                    function poprzednia(wartoscbody, wartoscznajdzm) {
                        return wartoscbody == wartoscznajdzm
                    }


                    //div.innerHTML = arr[i][j]
                    if (arr[i][j] == dlugosc) {
                        div.classList.add("head")

                        switch (strona) {
                            case "g":
                                div.classList.add("head-g")
                                break
                            case "d":
                                div.classList.add("head-d")
                                break
                            case 'l':
                                div.classList.add("head-l")
                                break
                            case 'p':
                                div.classList.add("head-p")
                                break
                        }

                        div.classList.add("cialo")
                    } else if (arr[i][j] == 0) {
                        div.classList.add("polko")
                    } else if (arr[i][j] == "x") {
                        div.classList.add("sciana")
                    } else if (arr[i][j] == "j") {
                        div.classList.add("jabko")
                    } else if (arr[i][j] == 1) {
                        div.classList.add("cialo")
                        if (dlugosc > 1) {

                            div.classList.add("ogonek")
                            switch (ogonek) {
                                case "g":
                                    div.classList.add("ogonek-g")
                                    break
                                case "d":
                                    div.classList.add("ogonek-d")
                                    break
                                case 'l':
                                    div.classList.add("ogonek-l")
                                    break
                                case 'p':
                                    div.classList.add("ogonek-p")
                                    break
                            }
                        }
                    } else {
                        div.classList.add("cialo")
                    }
                    if (j == 0) {
                        div.classList.add("koniec")
                    }
                    cmp.appendChild(div)
                }
            }
        }

        function szukajkanexta(elemencik) {
            return elemencik == 2
        }

        function szukajkaogona(pozycja) {
            return pozycja == 1
        }



        function jablko(arr) {
            cos = document.getElementsByClassName("polko")
            tablicawolnych = Array.from(cos)
            //console.log(cos)
            if (tablicawolnych == "") {
                alert("wygrałeś")
                strona = "p"
                flaga = 5
                mozliwoscruchu = 1
                dlugosc = 1
                tab = generateArr()
            } else {
                //console.log(tablicawolnych)
                wybrany = cos[Math.floor(Math.random() * cos.length)]
                wybraneid = wybrany.id
                //console.log(wybraneid)
                tabkaid = wybraneid.split("_")
                //console.log(tabkaid)
                arr[tabkaid[0]][tabkaid[1]] = "j"
            }
            dlugosc = zwiekszdlugosc(dlugosc)
        }

        function flagaruchu(e) {

            if (e.key == "ArrowRight" || e.key == "ArrowLeft") {
                if ((flaga == 0 || flaga == 3 || flaga == 5) && mozliwoscruchu == 1) {
                    mozliwoscruchu = 0
                    if (e.key == "ArrowRight") {
                        flaga = 1
                    } else if (e.key == "ArrowLeft") {
                        flaga = 2
                    }
                }
            } else if (e.key == "ArrowDown" || e.key == "ArrowUp") {
                if ((flaga == 1 || flaga == 2 || flaga == 5) && mozliwoscruchu == 1) {
                    mozliwoscruchu = 0
                    if (e.key == "ArrowDown") {
                        flaga = 0
                    } else if (e.key == "ArrowUp") {
                        flaga = 3
                    }
                }
            }


        }



        function ruch(flaga) {
            mozliwoscruchu = 1
            if (flaga == 0) {
                ruchy()
            } else if (flaga == 1) {
                ruchy()
            } else if (flaga == 2) {
                ruchy()
            } else if (flaga == 3) {
                ruchy()
            }
        }

        function ruchy() {
            let objindex = indexglowy()
            //console.log(objindex)
            //console.log(objindex.x)
            let pozycjax = objindex.x
            let pozycjay = objindex.y
            kierunek(event, pozycjax, pozycjay)
            document.getElementById("cmp").remove()
            let div = document.createElement("div")
            div.id = "cmp"
            document.getElementById("body").appendChild(div)
            generateDOM(tab)
        }

        function kierunek(e, pozycjax, pozycjay) {
            //console.log(e.key)
            if (flaga == 0) {

                if (tab[pozycjay + 1][pozycjax] == "j") {
                    jablko(tab)
                    tab[pozycjay + 1][pozycjax] = dlugosc
                } else if (tab[pozycjay + 1][pozycjax] != 0 && tab[pozycjay + 1][pozycjax] != "j") {
                    przegrana()
                } else {
                    //tab[pozycjay][pozycjax] = 0
                    ogon(tab)
                    tab[pozycjay + 1][pozycjax] = dlugosc
                    strona = "d"
                    //console.table(tab)
                }
            } else if (flaga == 1) {
                if (tab[pozycjay][pozycjax + 1] == "j") {
                    jablko(tab)
                    tab[pozycjay][pozycjax + 1] = dlugosc
                } else if (tab[pozycjay][pozycjax + 1] != 0 && tab[pozycjay][pozycjax + 1] != "j") {
                    przegrana()
                } else {
                    ogon(tab)
                    tab[pozycjay][pozycjax + 1] = dlugosc
                    strona = "p"
                }
            } else if (flaga == 2) {
                if (tab[pozycjay][pozycjax - 1] == "j") {
                    jablko(tab)
                    tab[pozycjay][pozycjax - 1] = dlugosc
                } else if (tab[pozycjay][pozycjax - 1] != 0 && tab[pozycjay][pozycjax - 1] != "j") {
                    przegrana()
                } else {
                    ogon(tab)
                    tab[pozycjay][pozycjax - 1] = dlugosc
                    strona = "l"
                }
            } else if (flaga == 3) {
                if (tab[pozycjay - 1][pozycjax] == "j") {
                    jablko(tab)
                    tab[pozycjay - 1][pozycjax] = dlugosc
                } else if (tab[pozycjay - 1][pozycjax] != 0 && tab[pozycjay - 1][pozycjax] != "j") {
                    przegrana()
                } else {
                    ogon(tab)
                    tab[pozycjay - 1][pozycjax] = dlugosc

                    strona = "g"
                }
            }
        }

        function przegrana() {
            alert("Przegrałeś")
            flaga = 5
            strona = "p"
            mozliwoscruchu = 1
            dlugosc = 1
            tab = generateArr()
        }

        function ogon(arr) {
            cialo = document.getElementsByClassName("cialo")
            tabkaciala = Array.from(cialo)
            //console.log(tabkaciala)
            //console.log(tabkaciala.length)
            for (let ele = 0; ele < tabkaciala.length; ele++) {
                let cialko = tabkaciala[ele]
                //console.log(cialko)
                let idcialka = cialko.id.split("_")
                let wartosccialka = arr[idcialka[0]][idcialka[1]]
                wartoscpozmianie = wartosccialka - 1
                arr[idcialka[0]][idcialka[1]] = wartoscpozmianie
            }
            //console.table(arr)
        }

        function zwiekszdlugosc(dlugosc) {
            dlugosc = dlugosc + 1
            //console.log(dlugosc)
            return dlugosc
        }


        function indexglowy() {
            for (let posy = 1; posy < 11; posy++) {
                let posx = tab[posy].findIndex(szukaczglowy)
                if (posx != -1) {
                    //console.log(posx)
                    //console.log(posy)
                    indexik = { x: posx, y: posy }
                }
            }
            return indexik
        }

        function szukaczglowy(index) {
            return index == dlugosc
        }

    </script>
</body>

</html>